//! kappa 0.0.1

"use strict";!function(a,b){"function"==typeof define&&define.amd?define([],b):"object"==typeof module&&module.exports?module.exports=b():a.kappa=b()}(this,function a(){var b={__name__:"kappa",__init__:a,__dependencies__:{},__version__:"0.0.1",utils:{},data:{},lexer:{},parser:{}};b.utils.obj=function(){var a=function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},b=function(a,b,d){if(!a||!b)throw new Error("Invalid property specification. In order to create a property please specify a context and a property name.");var e=c({enumerable:!0,configurable:!1,set:function(c){a.options[b]=c},get:function(){return a.options[b]}},d||{});Object.defineProperty(a,b,e)},c=function(a){for(var b=Array.prototype.slice.call(arguments,1),c=0;c<b.length;c++)if(b[c])for(var d in b[c])a[d]=b[c][d];return a},d=function(a){return JSON.parse(JSON.stringify(a))},e=function(a){for(var b=Array.prototype.slice.call(arguments,1),c=d(a),e=0;e<b.length;e++)if(b[e])for(var f in b[e])c[f]=b[e][f];return c},f=function(a){return"[object Array]"===Object.prototype.toString.call(a)},g=function(a){return"[object String]"===Object.prototype.toString.call(a)},h=function(a){return"[object RegExp]"===Object.prototype.toString.call(a)},i=function(a){return"[object Number]"===Object.prototype.toString.call(a)},j=function(a){return"[object Function]"===Object.prototype.toString.call(a)},k=function(a){return a===!0||a===!1||"[object Boolean]"===Object.prototype.toString.call(a)},l=function(a){return"[object Arguments]"===Object.prototype.toString.call(a)};l(arguments)||(l=function(a){return!(!a||!C(a,"callee"))});var m=function(a){return a===Object(a)&&!j(a)},n=function(a){return void 0===a},o={},p=Array.prototype,q=p.concat,r=p.push,s=Function.prototype,t=Object.keys,u=p.forEach,v=p.reduce,w=s.bind,x=p.filter,y=p.some,z=p.every,A=p.indexOf,B=p.slice,C=function(a,b){return hasOwnProperty.call(a,b)},D=function(a){if(!m(a))return[];if(t)return t(a);var b=[];for(var c in a)C(a,c)&&b.push(c);return b},E=function(a,b,c){if(null===a)return a;var d,e;if(u&&a.forEach===u)a.forEach(b,c);else if(a.length===+a.length){for(d=0,e=a.length;e>d;d++)if(b.call(c,a[d],d,a)===o)return}else{var f=D(a);for(d=0,e=f.length;e>d;d++)if(b.call(c,a[f[d]],f[d],a)===o)return}return a},F=function(a,b,c){var d=[];return null===a?d:(E(a,function(a,e,f){d.push(b.call(c,a,e,f))}),d)},G="Reduce of empty array with no initial value",H=function(a,b,c,d){var e=arguments.length>2;if(null===a&&(a=[]),v&&a.reduce===v)return d&&(b=J(b,d)),e?a.reduce(b,c):a.reduce(b);if(E(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)}),!e)throw new TypeError(G);return c},I=function(){},J=function(a,b){var c,d;if(w&&a.bind===w)return w.apply(a,B.call(arguments,1));if(!j(a))throw new TypeError;return c=B.call(arguments,2),d=function(){if(!(this instanceof d))return a.apply(b,c.concat(B.call(arguments)));I.prototype=a.prototype;var e=new I;I.prototype=null;var f=a.apply(e,c.concat(B.call(arguments)));return Object(f)===f?f:e}},K=function(a,b,c){var d=[];return null===a?d:x&&a.filter===x?a.filter(b,c):(E(a,function(a,e,f){b.call(c,a,e,f)&&d.push(a)}),d)},L=function(a){return a},M=function(a,b,c){b=b||L;var d=!1;return null===a?d:y&&a.some===y?a.some(b,c):(E(a,function(a,e,f){return d||(d=b.call(c,a,e,f))?o:void 0}),!!d)},N=function(a,b){return F(a,O(b))},O=function(a){return function(b){return b[a]}},P=function(a){return null===a||void 0===a?L:j(a)?a:O(a)},Q=function(a,b,c){return b=P(b),N(F(a,function(a,d,e){return{value:a,index:d,criteria:b.call(c,a,d,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index-b.index}),"value")},R=function(a,b,c){var d;return M(a,function(a,e,f){return b.call(c,a,e,f)?(d=a,!0):void 0}),d},S=function(a){return function(b,c,d){var e={};return c=P(c),E(b,function(f,g){var h=c.call(d,f,g,b);a(e,h,f)}),e}},T=function(a,b,c){b=b||L;var d=!0;return null===a?d:z&&a.every===z?a.every(b,c):(E(a,function(a,e,f){return(d=d&&b.call(c,a,e,f))?void 0:o}),!!d)},U=function(a,b,c){return b&&T(a,f)?q.apply(c,a):(E(a,function(a){f(a)||l(a)?b?r.apply(c,a):U(a,b,c):c.push(a)}),c)},V=function(a,b){return U(a,b,[])},W=function(a,b){return null===a?!1:A&&a.indexOf===A?-1!==a.indexOf(b):M(a,function(a){return a===b})},X=function(a,b,c,d){j(b)&&(d=c,c=b,b=!1);var e=c?F(a,c,d):a,f=[],g=[];return E(e,function(c,d){(b?d&&g[g.length-1]===c:W(g,c))||(g.push(c),f.push(a[d]))}),f},Y=S(function(a,b,c){C(a,b)?a[b].push(c):a[b]=[c]}),Z=function(a,b,c,d){c=P(c);for(var e=c.call(d,b),f=0,g=a.length;g>f;){var h=f+g>>>1;c.call(d,a[h])<e?f=h+1:g=h}return f},$=function(a,b,c){if(null===a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=Z(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}if(A&&a.indexOf===A)return a.indexOf(b,c);for(;e>d;d++)if(a[d]===b)return d;return-1},_=0,ab=function(a){var b=++_+"";return a?a+b:b},bb=function(a,b,c){return null===a||void 0===a?void 0:null===b||void 0===b||c?a[a.length-1]:B.call(a,Math.max(a.length-b,0))};return{inherit:a,extend:c,extendInNew:e,clone:d,isArray:f,isString:g,isRegExp:h,isNumber:i,isObject:m,isFunction:j,isArguments:l,isBoolean:k,isUndefined:n,keys:D,each:E,map:F,has:C,reduce:H,bind:J,filter:K,any:M,defineProperty:b,pluck:N,sortBy:Q,property:O,find:R,every:T,flatten:V,groupBy:Y,contains:W,uniq:X,sortedIndex:Z,indexOf:$,uniqueId:ab,last:bb}}(),b.utils.str=function(){var a=function(a,b){return a?String.prototype.slice.call(a,0,b.length)===b:!1},b=function(a){return a.replace(/^\s+|\s+$/g,"")},c=function(a){return a.replace(/^\s+/,"")},d=function(a){return a.replace(/\s+$/,"")},e=function(a){return a.replace(/(?:(?:^|\n)\s+|\s+(?:$|\n))/g,"").replace(/\s+/g," ")},f=function(a){for(var b="",c=a;c--;)b+="	";return b};return{startsWith:a,trim:b,ltrim:c,rtrim:d,fulltrim:e,tabs:f}}(),b.data.Node=function(){var a=function(a){this.options=a,b.utils.obj.defineProperty(this,"transitions"),b.utils.obj.defineProperty(this,"nodes"),b.utils.obj.defineProperty(this,"name"),b.utils.obj.defineProperty(this,"_id"),this.transitions=a.transitions||[],this.nodes=a.nodes||[]};return a.prototype.getIdentity=function(){return this._id||(this._id=this._generateIdentity()),this._id},a.prototype._generateIdentity=function(){return this.name||b.utils.obj.uniqueId("node_")},a.prototype.addTransition=function(a,b){this.transitions.push(this._generateNewTransition(a,b)),this.nodes.push(b)},a.prototype._generateNewTransition=function(a,b){return{transitionValue:a,node:b}},a.prototype.toString=function(){return this.getIdentity()},a}();{var c=b.data.specialSymbol={EMPTY:"EMPTY",EOF:"EOF"},d=(b.data.associativity={LEFT:"LEFT",RIGHT:"RIGHT"},b.data.Symbol=function(){var a=function(a){if(this.options=a,b.utils.obj.defineProperty(this,"name"),b.utils.obj.defineProperty(this,"isSpecial"),b.utils.obj.defineProperty(this,"rule"),this.isSpecial=b.utils.obj.isBoolean(a.isSpecial)?a.isSpecial:!0,!this.name||!b.utils.obj.isString(this.name))throw new Error("Invalid initialization values for a symbol, please provide a string name a symbol")};return a.prototype.toString=function(){return this.name.toString()},a}()),e=b.data.NonTerminal=function(a){function c(){a.apply(this,arguments),b.utils.obj.defineProperty(this,"isNullable"),this.isNullable=!1,this.isSpecial=!1}return b.utils.obj.inherit(c,a),c.fromArray=function(a){if(!b.utils.obj.isArray(a)&&!b.utils.obj.isString(a))throw new Error("Invalid parameter. To create non terminal from array the input parameter should be an array!");var c=[];return b.utils.obj.each(a,function(a){c[c.length]=new e({name:a})}),c},c}(d),f=b.data.Terminal=function(a){function c(c){if(!b.utils.obj.isString(c.body)&&!b.utils.obj.isRegExp(c.body))throw new Error("Invalid Terminal Initialization. A string or regexp body must be specified");c.name=c.name?c.name:c.body.toString(),a.apply(this,arguments),b.utils.obj.defineProperty(this,"body"),b.utils.obj.defineProperty(this,"isTerminal"),b.utils.obj.defineProperty(this,"assoc"),this.isSpecial=!1,this.isTerminal=!0}return b.utils.obj.inherit(c,a),c.prototype.toString=function(){return"<"+this.name+">"},c}(d),g=b.data.Rule=function(){var a=function(a){if(this.options=a,!a.head)throw new Error("Invalid initialization values, please provide a head for the rule");b.utils.obj.defineProperty(this,"head"),b.utils.obj.defineProperty(this,"tail"),b.utils.obj.defineProperty(this,"reduceFunc"),b.utils.obj.defineProperty(this,"name"),b.utils.obj.defineProperty(this,"precendence"),b.utils.obj.defineProperty(this,"index"),b.utils.obj.defineProperty(this,"isProductive"),b.utils.obj.defineProperty(this,"isReachable"),b.utils.obj.defineProperty(this,"terminalsCount"),this.index=-1,this.isProductive=!1,this.isReachable=!1,this.terminalsCount=0,this.head=a.head instanceof e?a.head:new e({name:a.head.toString()}),this.tail=a.tail&&b.utils.obj.isArray(a.tail)?a.tail:[new d({name:c.EMPTY,isSpecial:!0})],b.utils.obj.each(this.tail,function(a){a instanceof f&&this.terminalsCount++,a.rule=this},this)};return a.prototype.toString=function(){return this.head.toString()+" --> "+this.tail.join(" ")},a}();b.data.Grammar=function(){var a={name:""},h=function(c){if(this.options=b.utils.obj.extendInNew(a,c||{}),b.utils.obj.defineProperty(this,"startSymbol"),b.utils.obj.defineProperty(this,"name"),b.utils.obj.defineProperty(this,"rules"),b.utils.obj.defineProperty(this,"preserveNonProductiveRules"),b.utils.obj.defineProperty(this,"preserveUnReachableRules"),b.utils.obj.defineProperty(this,"specifiedStartSymbol"),b.utils.obj.defineProperty(this,"terminals"),b.utils.obj.defineProperty(this,"rulesByHeader"),b.utils.obj.defineProperty(this,"firstSetsByHeader"),b.utils.obj.defineProperty(this,"nullableNonTerminals"),!(this.startSymbol instanceof d))throw new Error("Invalid grammar creation, please specify a start Symbol!");this.nullableNonTerminals=[],this._generateRequireRequisites()};return h.constants={AugmentedRuleName:"AUGMENTRULE"},h.prototype._isRuleProductive=function(a){return!b.utils.obj.find(a.tail,function(a){return a instanceof e&&(this.rulesByHeader[a.name]&&b.utils.obj.every(this.rulesByHeader[a.name],function(a){return!a.isProductive})||!this.rulesByHeader[a.name])?!0:!1},this)},h.prototype._generateRequireRequisites=function(){var a=this._augmentGrammar(this.startSymbol,this.startSymbol);b.utils.obj.each(this.rules,function(a,b){a.index=b}),this._indexRulesByHead(),a=this._cleanUnProductiveRules()||a,this._indexRulesByHead(),this._cleanUnReachableRules(a),this._indexRulesByHead(),this._removeMiddleTailEpsilons(),this._determineNullableNonTerminals(),this.terminals=this._generateListOfTerminals(),this.firstSetsByHeader=this._precalculateFirstTerminals()},h.prototype._indexRulesByHead=function(){this.rulesByHeader=b.utils.obj.groupBy(this.rules,function(a){return a.head.name})},h.prototype._precalculateFirstTerminals=function(){var a={};return b.utils.obj.each(b.utils.obj.keys(this.rulesByHeader),function(b){a[b]=this._calculateFirstSetForHead(b)},this),a},h.prototype._calculateFirstSetForHead=function(a,d){var g=[];return d=d||{},b.utils.obj.each(this.rulesByHeader[a],function(a){b.utils.obj.find(a.tail,function(a){if(a instanceof e){if(d[a.name])return!a.isNullable;d[a.name]=!0}else if(a.isSpecial&&a.name===c.EOF)return!0;if(a instanceof f||a.name===c.EMPTY&&a.isSpecial)g.push(a);else{if(!(a instanceof e))throw new Error("Impossible to calculate FIRST Set, some rules have invalid tail symbols");g=g.concat(b.utils.obj.flatten(this._calculateFirstSetForHead(a.name,d),!0))}return!b.utils.obj.find(g,function(a){return a.name===c.EMPTY})},this)},this),b.utils.obj.uniq(g,!1,function(a){return a.name})},h.prototype._augmentGrammar=function(a,d){this.specifiedStartSymbol=d;var e=new g({head:"S'",tail:[a,new b.data.Symbol({name:c.EOF,isSpecial:!0})],name:h.constants.AugmentedRuleName});return this.rules.unshift(e),this.startSymbol=e.head,e},h.prototype._cleanUnProductiveRules=function(){var a,d=!1,e=0;do d=!1,b.utils.obj.each(this.rules,function(a){a.isProductive||(a.isProductive=this._isRuleProductive(a),d=d||a.isProductive)},this);while(d);if(!this.preserveNonProductiveRules){for(;e<this.rules.length;)this.rules[e].isProductive?e++:this.rules.splice(e,1);0===this.rules.length&&(a=this._augmentGrammar(new b.data.Symbol({name:c.EMPTY,isSpecial:!0}),this.specifiedStartSymbol),a.index=0)}return a},h.prototype._removeMiddleTailEpsilons=function(){var a=0;b.utils.obj.each(this.rules,function(d){for(a=0;a<d.tail.length;)d.tail[a].isSpecial&&d.tail[a].name===b.data.specialSymbol.EMPTY&&(a+1<d.tail.length&&(!d.tail[a+1].isSpecial||d.tail[a+1].name!==c.EOF)||a===d.tail.length-1&&a>0&&!d.tail[a-1].isSpecial)&&(d.tail.splice(a,1),--a),a++})},h.prototype._cleanUnReachableRules=function(a){var c=!1,d=0;a.isReachable=!0;do c=!1,b.utils.obj.each(this.rules,function(a){a.isReachable&&b.utils.obj.each(a.tail,function(a){a instanceof e&&b.utils.obj.each(this.rulesByHeader[a.name],function(a){a.isReachable||(c=!0,a.isReachable=!0)})},this)},this);while(c);if(!this.preserveUnReachableRules)for(d=0;d<this.rules.length;)this.rules[d].isReachable?d++:this.rules.splice(d,1)},h.prototype._generateListOfTerminals=function(){var a=b.utils.obj.flatten(b.utils.obj.map(this.rules,function(a){return a.tail}),!1);return b.utils.obj.filter(b.utils.obj.uniq(a,!1,function(a){return a.name}),function(a){return a.isTerminal})},h.prototype._determineNullableNonTerminals=function(){var a=!1,c=!1;do c=!1,b.utils.obj.each(this.rules,function(d){1!==d.tail.length||d.tail[0].name!==b.data.specialSymbol.EMPTY||d.head.isNullable?0===d.terminalsCount&&(a=b.utils.obj.every(d.tail,function(a){return this.nullableNonTerminals.indexOf(a.name)>=0},this),a&&!d.head.isNullable&&(d.head.isNullable=!0,c=!0,this.nullableNonTerminals.push(d.head.name))):(d.head.isNullable=!0,c=!0,this.nullableNonTerminals.push(d.head.name))},this);while(c);var d=b.utils.obj.flatten(b.utils.obj.map(this.rules,function(a){return a.tail.concat(a.head)}),!1),f=b.utils.obj.filter(d,function(a){return a instanceof e&&this.nullableNonTerminals.indexOf(a.name)>=0},this);b.utils.obj.each(f,function(a){a.isNullable=!0})},h.prototype.getRulesFromNonTerminal=function(a){return this.rulesByHeader[a.name]},h.prototype.toString=function(){var a=this.name?"Name: "+this.name+"\n":"";return a+="Start Symbol: "+this.startSymbol.name+"\n",a+=b.utils.obj.reduce(b.utils.obj.sortBy(this.rules,function(a){return a.index}),function(a,b){return a+"\n"+b.index+". "+b.toString()},"")},h}()}b.data.ASTNode=function(a){function c(){a.apply(this,arguments),b.utils.obj.defineProperty(this,"rule"),b.utils.obj.defineProperty(this,"stringValue"),b.utils.obj.defineProperty(this,"currentValue"),b.utils.obj.defineProperty(this,"symbol")}return b.utils.obj.inherit(c,a),c.prototype.toString=function(a){if(a&&!b.utils.obj.isUndefined(a.deep)){a.deep=b.utils.obj.isNumber(a.deep)?a.deep:0;var c=b.utils.str.tabs(a.deep);return++a.deep,c+this._toCurrentString()+"\n"+b.utils.obj.reduce(this.nodes,function(c,d){return c+(b.utils.obj.isString(d)?b.utils.str.tabs(a.deep)+d+"\n":d.toString({deep:a.deep}))},"")}return this._toCurrentString()},c.prototype._toCurrentString=function(){return this.getIdentity()+(this.rule?": "+this.rule.toString()+" ("+this.currentValue+")":"")},c}(b.data.Node);var h=b.data.ItemRule=function(){var a={dotLocationIncrement:0},c=function(a){this.options=a,b.utils.obj.defineProperty(this,"rule"),b.utils.obj.defineProperty(this,"dotLocation"),b.utils.obj.defineProperty(this,"lookAhead"),b.utils.obj.defineProperty(this,"_id"),this.lookAhead=this.lookAhead||[],this.dotLocation=a.dotLocation||0,this.rule&&1===this.rule.tail.length&&this.rule.tail[0].name===b.data.specialSymbol.EMPTY&&(this.dotLocation=1)};return c.prototype.toString=function(){for(var a=this.getIdentity()+".  "+this.rule.head.name+"-->",b=0;b<this.rule.tail.length;b++)a+=(this.dotLocation===b?"*":" ")+this.rule.tail[b].toString();return this.dotLocation===b&&(a+="*"),a+=",    ["+this.lookAhead.join(", ")+"]"},c.prototype.clone=function(c,d){var e=b.utils.obj.extendInNew(a,c||{}),f=this._cloneCurrentOptions(c,d),g=new h(f);return g._incrementDotLocation(e.dotLocationIncrement),g._id=null,g},c.prototype._cloneCurrentOptions=function(a,c){var d=this.rule,e=this.lookAhead;this.rule=this.lookAhead=null;var f=b.utils.obj.extendInNew(this.options,c||{});return this.rule=f.rule=d,this.lookAhead=e,f.lookAhead=[].concat(e),f},c.prototype._incrementDotLocation=function(a){var c=b.utils.obj.isNumber(this.options.dotLocation)?this.options.dotLocation:0,d=b.utils.obj.isNumber(a)?a:1;this.dotLocation=c+d},c.prototype.getIdentity=function(){return this._id||(this._id=this._generateIdentity()),this._id},c.prototype._generateIdentity=function(){return this.rule.index+"("+this.dotLocation+")"},c.prototype.getCurrentSymbol=function(){return this.dotLocation<this.rule.tail.length+1?this.rule.tail[this.dotLocation]:null},c.prototype.isReduce=function(){return this.dotLocation===this.rule.tail.length},c.newFromRules=function(a,c){return b.utils.obj.reduce(a,function(a,b){return a.push(new h({rule:b,dotLocation:0,lookAhead:[].concat(c||[])})),a},[])},c}();b.data.sampleGrammars={numDivs:function(){var a=new b.data.Rule({head:"S",tail:b.data.NonTerminal.fromArray(["E"]),name:"SRULE"}),c=new b.data.Rule({head:"E",tail:b.data.NonTerminal.fromArray(["E","Q","F"]),name:"E1RULE"}),d=new b.data.Rule({head:"E",tail:b.data.NonTerminal.fromArray(["F"]),name:"E2RULE"}),e=new b.data.Rule({head:"Q",tail:[new b.data.Terminal({name:"DIV",body:/\//})],name:"QRULE"}),f=new b.data.Rule({head:"F",tail:[new b.data.Terminal({name:"NUMBER",body:/\d/})],name:"FRULE"});return{g:new b.data.Grammar({startSymbol:a.head,rules:[a,c,d,e,f],name:"numDivs"}),S:a,E1:c,E2:d,Q:e,F:f}}(),idsList:function(){var a=new b.data.Rule({head:"S",tail:b.data.NonTerminal.fromArray(["OPAREN","EXPS","CPAREN"]),name:"SRULE"}),c=new b.data.Rule({head:"EXPS",tail:b.data.NonTerminal.fromArray(["EXPS","EXP"]),name:"EXPS1RULE"}),d=new b.data.Rule({head:"EXPS",name:"EXPS2RULE"}),e=new b.data.Rule({head:"EXP",tail:[new b.data.Terminal({name:"id_terminal",body:/[a-zA-Z]+/})],name:"EXPRULE"}),f=new b.data.Rule({head:"OPAREN",tail:[new b.data.Terminal({name:"oparen_terminal",body:/\(/})],name:"OPARENRULE"}),g=new b.data.Rule({head:"CPAREN",tail:[new b.data.Terminal({name:"cparen_terminal",body:/\)/})],name:"CPARENRULE"});return{g:new b.data.Grammar({startSymbol:a.head,rules:[a,c,d,e,f,g],name:"idsList"}),S:a,EXPS1:c,EXPS2:d,EXP:e,OPAREN:f,CPAREN:g}}(),numDivsEmpty:function(){var a=new b.data.Rule({head:"S",tail:b.data.NonTerminal.fromArray(["E"]),name:"SRULE"}),c=new b.data.Rule({head:"E",tail:b.data.NonTerminal.fromArray(["E","Q","F"]),name:"E1RULE"}),d=new b.data.Rule({head:"E",tail:b.data.NonTerminal.fromArray(["F"]),name:"E2RULE"}),e=new b.data.Rule({head:"Q",tail:[new b.data.Terminal({name:"DIV",body:/\//})],name:"Q1RULE"}),f=new b.data.Rule({head:"Q",name:"Q2RULE"}),g=new b.data.Rule({head:"F",tail:[new b.data.Terminal({name:"NUMBER",body:/\d/})],name:"FRULE"});return{g:new b.data.Grammar({startSymbol:a.head,rules:[a,c,d,e,f,g],name:"numDivsEmpty"}),S:a,E1:c,E2:d,Q1:e,Q2:f,F:g}}(),numDiff:function(){var a=new b.data.Rule({head:"S",tail:b.data.NonTerminal.fromArray(["E"]),name:"SRULE"}),c=new b.data.Rule({head:"E",tail:b.data.NonTerminal.fromArray(["E","R","T"]),name:"E1RULE"}),d=new b.data.Rule({head:"E",tail:b.data.NonTerminal.fromArray(["T"]),name:"E2RULE"}),e=new b.data.Rule({head:"T",tail:[new b.data.Terminal({name:"NUMBER",body:/\d/})],name:"T1RULE"}),f=new b.data.Rule({head:"T",tail:b.data.NonTerminal.fromArray(["OPAREN","E","CPAREN"]),name:"T2RULE"}),g=new b.data.Rule({head:"OPAREN",tail:[new b.data.Terminal({name:"OPAREN",body:/\(/})],name:"OPARENRULE"}),h=new b.data.Rule({head:"CPAREN",tail:[new b.data.Terminal({name:"CPAREN",body:/\)/})],name:"CPARENRULE"}),i=new b.data.Rule({head:"R",tail:[new b.data.Terminal({name:"DIFF",body:"-"})],name:"RRULE"});return{g:new b.data.Grammar({startSymbol:a.head,rules:[a,c,d,e,f,g,h,i],name:"numDiff"}),S:a,E1:c,E2:d,T1:e,T2:f,OPAREN:g,CPAREN:h,R:i}}(),aPlusb:function(){var a=new b.data.Rule({head:"A",tail:[new b.data.Terminal({name:"A_LET",body:"a"}),new b.data.NonTerminal({name:"A"})],name:"A1RULE"}),c=new b.data.Rule({head:"A",tail:[new b.data.Terminal({name:"B_LET",body:"b"})],name:"A2RULE"});return{g:new b.data.Grammar({startSymbol:a.head,rules:[a,c],name:"aPlusb"}),A1:a,A2:c}}(),aPlusEMPTY:function(){var a=new b.data.Rule({head:"S",tail:[new b.data.Terminal({name:"A_LET",body:"a"}),new b.data.NonTerminal({name:"S"})],name:"S1RULE"}),c=new b.data.Rule({head:"S",tail:[new b.data.Symbol({name:b.data.specialSymbol.EMPTY})],name:"S2RULE"});return{g:new b.data.Grammar({startSymbol:a.head,rules:[a,c],name:"aPlusEMPTY"}),S1:a,S2:c}}(),numDiffCondenced:function(){var a=new b.data.Rule({head:"S",tail:b.data.NonTerminal.fromArray(["E"]),name:"SRULE"}),c=new b.data.Rule({head:"E",tail:[new b.data.NonTerminal({name:"E"}),new b.data.Terminal({name:"DIFF",body:"-"}),new b.data.NonTerminal({name:"T"})],name:"E1RULE"}),d=new b.data.Rule({head:"E",tail:b.data.NonTerminal.fromArray(["T"]),name:"E2RULE"}),e=new b.data.Rule({head:"T",tail:[new b.data.Terminal({name:"NUMBER",body:/\d/})],name:"T1RULE"}),f=new b.data.Rule({head:"T",tail:[new b.data.Terminal({name:"OPAREN",body:/\(/}),new b.data.NonTerminal({name:"E"}),new b.data.Terminal({name:"CPAREN",body:/\)/})],name:"T2RULE"});return{g:new b.data.Grammar({startSymbol:a.head,rules:[a,c,d,e,f],name:"numDiffCondenced"}),S:a,E1:c,E2:d,T1:e,T2:f}}(),aPowN1b:function(){var a=new b.data.Rule({head:"S",tail:b.data.NonTerminal.fromArray(["A","D"]),name:"SRULE"}),c=new b.data.Rule({head:"A",tail:[new b.data.Terminal({name:"a_terminal",body:"a"}),new b.data.NonTerminal({name:"A"}),new b.data.Terminal({name:"b_terminal",body:"b"})],name:"A1RULE"}),d=new b.data.Rule({head:"A",tail:[new b.data.Terminal({name:"a_terminal",body:"a"})],name:"A2RULE"}),e=new b.data.Rule({head:"D",tail:[new b.data.Terminal({name:"d_terminal",body:"d"})],name:"DRULE"});return{g:new b.data.Grammar({startSymbol:a.head,rules:[a,c,d,e],name:"aPowN1b"}),S:a,A1:c,A2:d,D:e}}(),selectedBs:function(){var a=new b.data.Rule({head:"S",tail:[new b.data.Terminal({name:"b_terminal",body:"b"})],name:"S1RULE"}),c=new b.data.Rule({head:"S",tail:[new b.data.Terminal({name:"oparen_terminal",body:"("}),new b.data.NonTerminal({name:"L"}),new b.data.Terminal({name:"cparen_terminal",body:")"})],name:"S2RULE"}),d=new b.data.Rule({head:"L",tail:[new b.data.NonTerminal({name:"S"})],name:"L1RULE"}),e=new b.data.Rule({head:"L",tail:[new b.data.NonTerminal({name:"L"}),new b.data.Terminal({name:"semicol_terminal",body:";"}),new b.data.NonTerminal({name:"S"})],name:"L2RULE"});return{g:new b.data.Grammar({startSymbol:a.head,rules:[a,c,d,e],name:"selectedBs"}),S1:a,S2:c,L1:d,L2:e}}(),arithmetic:function(){var a=new b.data.NonTerminal({name:"E"}),c=new b.data.Terminal({name:"plus_terminal",body:"+",assoc:b.data.associativity.LEFT}),d=new b.data.Terminal({name:"minus_terminal",body:"-",assoc:b.data.associativity.LEFT}),e=new b.data.Terminal({name:"multi_terminal",body:"*",assoc:b.data.associativity.LEFT}),f=new b.data.Terminal({name:"div_terminal",body:"/",assoc:b.data.associativity.LEFT}),g=new b.data.Terminal({name:"oparen_terminal",body:"("}),h=new b.data.Terminal({name:"cparen_terminal",body:")"}),i=new b.data.Terminal({name:"number_terminal",body:/\d+/}),j=new b.data.Rule({head:a.name,tail:[a,c,a],reduceFunc:function(a){return a.values[0]+a.values[2]},precendence:10,name:"EPLUSRULE"}),k=new b.data.Rule({head:a.name,tail:[a,d,a],reduceFunc:function(a){return a.values[0]-a.values[2]},precendence:10,name:"EMINUSRULE"}),l=new b.data.Rule({head:a.name,tail:[a,e,a],reduceFunc:function(a){return a.values[0]*a.values[2]},precendence:20,name:"EMULTIRULE"}),m=new b.data.Rule({head:a.name,tail:[a,f,a],reduceFunc:function(a){return a.values[0]/a.values[2]},precendence:20,name:"EDIVRULE"}),n=new b.data.Rule({head:a.name,tail:[g,a,h],reduceFunc:function(a){return a.values[1]},precendence:30,name:"EPARENRULE"}),o=new b.data.Rule({head:a.name,tail:[i],reduceFunc:function(a){return parseInt(a.values[0])},name:"ENUMBERRULE"});return{g:new b.data.Grammar({startSymbol:j.head,rules:[j,k,l,m,n,o],name:"arithmetic"}),plus_T:c,minus_T:d,multi_T:e,div_T:f,number_T:i,E1:j,E2:k,E3:l,E4:m,E5:n,EN:o}}()},b.data.StackItem=function(){var a=function(a){if(this.options=a,b.utils.obj.defineProperty(this,"state"),b.utils.obj.defineProperty(this,"currentValue"),b.utils.obj.defineProperty(this,"stringValue"),b.utils.obj.defineProperty(this,"symbol"),b.utils.obj.defineProperty(this,"AST"),!this.state)throw new Error("Invalid initialization values for a Stack Item, please provide a valid state")};return a}(),b.data.State=function(a){function c(c){a.apply(this,arguments),b.utils.obj.defineProperty(this,"isAcceptanceState"),b.utils.obj.defineProperty(this,"_items"),b.utils.obj.defineProperty(this,"_registerItems"),b.utils.obj.defineProperty(this,"_index"),b.utils.obj.defineProperty(this,"_condencedView"),this.isAcceptanceState=!1,this._items=c.items||[],c.items=null,this._index=0,this._registerItems={},this._registerItemRules()}return b.utils.obj.inherit(c,a),c.prototype._registerItemRules=function(){b.utils.obj.each(this._items,function(a){this._registerItems[a.getIdentity()]=a},this)},c.constants={AcceptanceStateName:"AcceptanceState"},c.prototype.getNextItem=function(){return this._index<this._items.length?this._items[this._index++]:null},c.prototype.addItems=function(a,c){this._id=null,b.utils.obj.each(a,function(a){if(this._registerItems[a.getIdentity()]){if(c&&c.hasLookAhead){var d=this._registerItems[a.getIdentity()].lookAhead.concat(a.lookAhead);this._registerItems[a.getIdentity()].lookAhead=b.utils.obj.uniq(d,function(a){return a.name})}}else this._registerItems[a.getIdentity()]=a,this._items.push(a)},this)},c.prototype.toString=function(){var a="ID: "+this.getIdentity()+"\n"+this._items.join("\n")+"\nTRANSITIONS:\n";return b.utils.obj.each(this.transitions,function(b){a+="*--"+b.symbol+"-->"+b.state.getIdentity()+"\n"}),a},c.prototype.getCondencedString=function(){return this._condencedView||(this._condencedView=this._generateCondencedString()),this._condencedView},c.prototype._generateCondencedString=function(){return b.utils.obj.map(b.utils.obj.sortBy(this._items,function(a){return a.rule.index}),function(a){return a.rule.index}).join("-")},c.prototype._generateIdentity=function(){return this.isAcceptanceState?c.constants.AcceptanceStateName:this._items.length?b.utils.obj.reduce(b.utils.obj.sortBy(this._items,function(a){return a.rule.index}),function(a,b){return a+b.getIdentity()},""):a.prototype._generateIdentity.apply(this,arguments)},c.prototype.getItems=function(){return b.utils.obj.map(this._items,function(a){return a.clone()})},c.prototype.getOriginalItems=function(){return this._items},c.prototype.getOriginalItemById=function(a){return this._registerItems[a]},c.prototype.getSupportedTransitionSymbols=function(){var a,c={},d=[];return b.utils.obj.each(this._items,function(b){a=b.getCurrentSymbol(),a&&(c[a.name]?c[a.name].push(b):(c[a.name]=[b],d.push({symbol:a,items:c[a.name]})))}),d},c.prototype._generateNewTransition=function(a,b){return{symbol:a,state:b}},c.prototype.getRecudeItems=function(){return b.utils.obj.filter(this._items,function(a){return a.isReduce()})},c.prototype.isValid=function(a){a=b.utils.obj.isObject(a)?a:{},a.conflictResolvers=a.conflictResolvers||[];var c=this.getRecudeItems(),d=this,e=!1;if(!a.considerLookAhead||!c.length)return!(c.length!==this._items.length&&c.length>0||c.length>1);var f=b.utils.obj.filter(this._items,function(a){return!a.isReduce()});if(f.length&&c.length){var g=b.utils.obj.sortBy(b.utils.obj.filter(a.conflictResolvers,function(a){return a.type===b.parser.conflictResolverType.STATE_SHIFTREDUCE}),"order"),h=b.utils.obj.any(f,function(f){var h=f.getCurrentSymbol();return b.utils.obj.find(c,function(c){var i=b.utils.obj.find(c.lookAhead,function(a){return a.name===h.name});return i?(e=b.utils.obj.find(g,function(b){return b.resolve(a.automata,d,f,c)}),!e):!1})});if(h)return!1}if(c.length>1){var i=b.utils.obj.sortBy(b.utils.obj.filter(a.conflictResolvers,function(a){return a.type===b.parser.conflictResolverType.STATE_REDUCEREDUCE}),"order"),j=b.utils.obj.any(c,function(f){return b.utils.obj.find(c,function(c){if(c.getIdentity()===f.getIdentity())return!1;var g=b.utils.obj.find(f.lookAhead,function(a){return b.utils.obj.find(c.lookAhead,function(b){return b.name===a.name})});return g?(e=b.utils.obj.find(i,function(b){return b.resolve(a.automata,d,f,c)}),!e):!1})});if(j)return!1}return!0},c.prototype.getShiftReduceItemRule=function(a){a=b.utils.obj.isObject(a)?a:{},a.conflictResolvers=a.conflictResolvers||[];var c=this.getRecudeItems(),d=b.utils.obj.filter(this._items,function(a){return!a.isReduce()}),e=this,f=!!a.ignoreErrors,g={shiftItems:[],reduceItems:[]},h=!1;if(!a.considerLookAhead){if(c.length){if(d.length||1!==c.length)return!1;g.reduceItems=c}else g.shiftItems=d||[];return g}if(c=b.utils.obj.map(c,function(a){return a.clone()}),d.length){var i=b.utils.obj.sortBy(b.utils.obj.filter(a.conflictResolvers,function(a){return a.type===b.parser.conflictResolverType.STATE_SHIFTREDUCE}),"order"),j=b.utils.obj.any(d,function(d){var j=d.getCurrentSymbol(),k=b.utils.obj.find(c,function(c){var f=b.utils.obj.find(c.lookAhead,function(a){return a.name===j.name});if(f){var g;if(h=b.utils.obj.find(i,function(b){return g=b.resolve(a.automata,e,d,c)}),h&&g.action===b.parser.tableAction.SHIFT){var k=b.utils.obj.indexOf(c.lookAhead,f);c.lookAhead.splice(k,1)}return!h}return!1});return!k||f?(g.shiftItems.push(d),!1):!0});if(j)return!1}if(c.length){var k=b.utils.obj.sortBy(b.utils.obj.filter(a.conflictResolvers,function(a){return a.type===b.parser.conflictResolverType.STATE_REDUCEREDUCE}),"order"),l=b.utils.obj.any(c,function(d){var i=b.utils.obj.find(c,function(c){if(c.getIdentity()===d.getIdentity())return!1;var f=b.utils.obj.find(d.lookAhead,function(a){return b.utils.obj.find(c.lookAhead,function(b){return b.name===a.name})});return f?(h=b.utils.obj.find(k,function(b){return b.resolve(a.automata,e,d,c)}),!h):!1});return!i||f?(g.reduceItems.push(d),!1):!0});if(l)return!1}return g},c}(b.data.Node),b.data.Automata=function(){var a=function(a){this.options=a,b.utils.obj.defineProperty(this,"states"),b.utils.obj.defineProperty(this,"initialState"),b.utils.obj.defineProperty(this,"hasLookAhead"),b.utils.obj.defineProperty(this,"_index"),b.utils.obj.defineProperty(this,"_unprocessedStates"),b.utils.obj.defineProperty(this,"_registerStates"),this.states=a.states||[],this._unprocessedStates=[],this._index=0,this._registerStates=b.utils.obj.groupBy(this.states,function(a){return a.getIdentity()}),this.states.length&&(this._unprocessedStates=[].concat(this.states))};return a.prototype.toString=function(){return this.states.join("\n")},a.prototype.getNextState=function(){return this._unprocessedStates.splice(0,1)[0]},a.prototype.isValid=function(a){var c={considerLookAhead:this.hasLookAhead};return a=b.utils.obj.extendInNew(c,a||{}),a.automata=this,!b.utils.obj.any(this.states,function(b){return!b.isValid(a)},this)},a.prototype.initialStateAccessor=function(a){return a?void(this.initialState=a):this.initialState},a.prototype.addState=function(a){if(this._registerStates[a.getIdentity()]){if(this.hasLookAhead){var c=this._registerStates[a.getIdentity()],d=!1;if(b.utils.obj.each(c.getOriginalItems(),function(c){var e=a.getOriginalItemById(c.getIdentity()),f=c.lookAhead.length;c.lookAhead=b.utils.obj.uniq(c.lookAhead.concat(e.lookAhead),function(a){return a.name}),d||f===c.lookAhead.length||(d=!0)}),d){var e=b.utils.obj.find(this._unprocessedStates,function(a){return c.getIdentity()===a.getIdentity()});e||this._unprocessedStates.push(c)}}}else this._registerStates[a.getIdentity()]=a,this.states.push(a),this._unprocessedStates.push(a);
return this._registerStates[a.getIdentity()]},a}(),b.lexer.Lexer=function(){var a={notIgnoreSpaces:!1},c=function(c){this.options=b.utils.obj.extendInNew(a,c||{}),b.utils.obj.defineProperty(this,"grammar"),b.utils.obj.defineProperty(this,"stream"),b.utils.obj.defineProperty(this,"inputStream"),b.utils.obj.defineProperty(this,"notIgnoreSpaces"),this.setStream(this.stream)};return c.prototype.setStream=function(a){this.stream=a,this.inputStream=!this.notIgnoreSpaces&&this.stream?b.utils.str.ltrim(this.stream):this.stream,this.notIgnoreSpaces||""!==this.inputStream||(this.inputStream=null)},c.prototype._getErrorResult=function(){return{length:-1,string:this.inputStream,ERROR:"NOT MATCHING FOUND"}},c.prototype.getNext=function(){var a,c={length:-1},d=this.grammar.terminals,e=b.utils.obj.find(this.grammar.rules,function(a){return 1===a.tail.length&&a.tail[0].isSpecial&&a.tail[0].name===b.data.specialSymbol.EMPTY});if(null===this.inputStream)c={length:-1,terminal:new b.data.Symbol({name:b.data.specialSymbol.EOF})};else if(""===this.inputStream)e?(c={length:0,string:"",terminal:new b.data.Symbol({name:b.data.specialSymbol.EMPTY})},this.inputStream=null):c=this._getErrorResult();else{for(var f=0;f<d.length;f++)if(a=d[f].body,a instanceof RegExp&&!this.inputStream.search(a)){var g=a.exec(this.inputStream)[0];c.length<g.length&&(c={length:g.length,string:g,terminal:d[f]})}else b.utils.obj.isString(a)&&b.utils.str.startsWith(this.inputStream,a)&&c.length<a.length&&(c={length:a.length,string:a,terminal:d[f]});-1===c.length?c=this._getErrorResult():(this.inputStream=this.inputStream.substr(c.length),this.options.notIgnoreSpaces||(this.inputStream=b.utils.str.ltrim(this.inputStream),""===this.inputStream&&(this.inputStream=null)))}return c},c}();b.parser.tableAction={SHIFT:"SHIFT",REDUCE:"REDUCE",ERROR:"ERROR",ACCEPT:"ACCEPT"};b.parser.AutomataLRGeneratorBase=function(){var a=function(a){if(this.options=a,b.utils.obj.defineProperty(this,"grammar"),!(this.grammar instanceof b.data.Grammar))throw new Error("In order to create a new Automata Generator please provide a grammar!")};return a.prototype.expandItem=function(a){for(var c,d=a.getNextItem();d;)c=d.getCurrentSymbol(),c instanceof b.data.NonTerminal&&a.addItems(this._newItemRulesForStateExpansion(d,c),this._getExpansionItemNewItemsOptions()),d=a.getNextItem();return a},a.prototype._getExpansionItemNewItemsOptions=function(){return{hasLookAhead:!1}},a.prototype._newItemRulesForStateExpansion=function(){},a.prototype.generateAutomata=function(a){var c={notValidate:!1,conflictResolvers:[]};a=b.utils.obj.extendInNew(c,a||{});var d=this._generateAutomata();return a.notValidate||d.isValid(a)?d:!1},a.prototype._getConflictResolvers=function(){},a.prototype._generateAutomata=function(){var a=new b.data.State({items:this._getInitialStateItemRules()}),c=new b.data.Automata(this._getNewAutomataOptions(a));return c.initialStateAccessor(a),this._expandAutomata(c),c},a.prototype._getNewAutomataOptions=function(a){return{states:[this.expandItem(a)]}},a.prototype._getInitialStateItemRules=function(){},a.prototype._expandAutomata=function(a){for(var c=a.getNextState();c;){var d,e=c.getSupportedTransitionSymbols(),f=[];b.utils.obj.each(e,function(e){b.utils.obj.each(e.items,function(a){f.push(a.clone({dotLocationIncrement:1}))});var g=new b.data.State({items:f});this.expandItem(g,a),g.isAcceptanceState=!(1!==g.getOriginalItems().length||g.getOriginalItems()[0].rule.name!==b.data.Grammar.constants.AugmentedRuleName||2!==g.getOriginalItems()[0].dotLocation),d=a.addState(g),c.addTransition(e.symbol,d),f=[]},this),c=a.getNextState()}},a.prototype.generateGOTOTable=function(a){var c={};return b.utils.obj.each(a.states,function(a){c[a.getIdentity()]={},b.utils.obj.each(a.transitions,function(b){c[a.getIdentity()][b.symbol.toString()]=b.state})}),c},a.prototype.generateACTIONTable=function(){},a}(),b.parser.AutomataLR0Generator=function(a){function c(){a.apply(this,arguments)}return b.utils.obj.inherit(c,a),c.prototype._newItemRulesForStateExpansion=function(a,c){return b.data.ItemRule.newFromRules(this.grammar.getRulesFromNonTerminal(c))},c.prototype._getNewAutomataOptions=function(){var b=a.prototype._getNewAutomataOptions.apply(this,arguments);return b.hasLookAhead=!1,b},c.prototype._getInitialStateItemRules=function(){return[new b.data.ItemRule({rule:this.grammar.getRulesFromNonTerminal(this.grammar.startSymbol)[0],lookAhead:[]})]},c.prototype.generateACTIONTable=function(a){var c={};return b.utils.obj.each(a.states,function(a){var d=a.getItems();c[a.getIdentity()]=1===d.length&&d[0].dotLocation===d[0].rule.tail.length?a.isAcceptanceState?{action:b.parser.tableAction.ACCEPT,rule:d[0].rule}:{action:b.parser.tableAction.REDUCE,rule:d[0].rule}:{action:b.parser.tableAction.SHIFT}}),function(a,c){return function(a){return c[a]||{action:b.parser.tableAction.ERROR}}}(a.hasLookAhead,c)},c}(b.parser.AutomataLRGeneratorBase),b.parser.AutomataLALR1Generator=function(a){function c(){a.apply(this,arguments)}return b.utils.obj.inherit(c,a),c.prototype._newItemRulesForStateExpansion=function(a,c){var d=this._getFirstSet(a);return b.data.ItemRule.newFromRules(this.grammar.getRulesFromNonTerminal(c),d)},c.prototype._getExpansionItemNewItemsOptions=function(){return{hasLookAhead:!0}},c.prototype._getFirstSet=function(a){var c=a.rule.tail.slice(a.dotLocation+1),d=[];return c=c.concat(a.lookAhead),b.utils.obj.find(c,function(c){if(c instanceof b.data.NonTerminal)return d=d.concat(this.grammar.firstSetsByHeader[c.name]),d=b.utils.obj.uniq(d,!1,function(a){return a.name}),!c.isNullable;if(c instanceof b.data.Terminal)return d.push(c),!0;if(c.isSpecial&&c.name===b.data.specialSymbol.EOF)return d.push(c),!0;throw new Error("Invalid Item Rule. Impossible calculate first set. Item Rule: "+a.toString())},this),d},c.prototype._getNewAutomataOptions=function(){var b=a.prototype._getNewAutomataOptions.apply(this,arguments);return b.hasLookAhead=!0,b},c.prototype._getInitialStateItemRules=function(){return[new b.data.ItemRule({rule:this.grammar.getRulesFromNonTerminal(this.grammar.startSymbol)[0],lookAhead:[new b.data.Symbol({name:b.data.specialSymbol.EOF,isSpecial:!0})]})]},c.prototype.generateACTIONTable=function(a,c){var d={};return b.utils.obj.each(a.states,function(a){if(d[a.getIdentity()]={},a.isAcceptanceState)d[a.getIdentity()][b.data.specialSymbol.EOF]={action:b.parser.tableAction.ACCEPT,rule:a.getOriginalItems()[0].rule};else{var e={ignoreErrors:!1,considerLookAhead:!0};c=b.utils.obj.extendInNew(e,c||{});var f=a.getShiftReduceItemRule(c);if(!f)throw new Error("Impossible to generate Action Table. The following state is invalid. State: "+a.getIdentity());b.utils.obj.each(f.shiftItems,function(c){d[a.getIdentity()][c.getCurrentSymbol().name]={action:b.parser.tableAction.SHIFT}}),b.utils.obj.each(f.reduceItems,function(c){b.utils.obj.each(c.lookAhead,function(e){d[a.getIdentity()][e.name]={action:b.parser.tableAction.REDUCE,rule:c.rule}})})}}),function(a,c){return function(a,d){return c[a]&&d&&d.name&&c[a][d.name]||{action:b.parser.tableAction.ERROR}}}(a.hasLookAhead,d)},c}(b.parser.AutomataLRGeneratorBase);{var i=b.parser.conflictResolverType={STATE_SHIFTREDUCE:"STATE_SHIFTREDUCE",STATE_REDUCEREDUCE:"STATE_REDUCEREDUCE"},j=b.parser.ConflictResolver=function(){var a=function(a){this.options=a,b.utils.obj.defineProperty(this,"name"),b.utils.obj.defineProperty(this,"type"),b.utils.obj.defineProperty(this,"order"),b.utils.obj.defineProperty(this,"resolveFnc"),this.type=this.type||i.STATE_SHIFTREDUCE,this.order=this.order||9999};return a.prototype.resolve=function(a,c,d,e){return b.utils.obj.isFunction(this.resolveFnc)?this.resolveFnc(a,c,d,e):!1},a.getDefaultResolvers=function(){return[new j({name:"precedence_resolver",type:i.STATE_SHIFTREDUCE,order:10,resolveFnc:function(a,c,d,e){return b.utils.obj.isNumber(d.rule.precendence)||b.utils.obj.isNumber(e.rule.precendence)?(d.rule.precendence=b.utils.obj.isNumber(d.rule.precendence)?d.rule.precendence:0,e.rule.precendence=b.utils.obj.isNumber(e.rule.precendence)?e.rule.precendence:0,d.rule.precendence>e.rule.precendence?{itemRule:d,action:b.parser.tableAction.SHIFT}:d.rule.precendence<e.rule.precendence?{itemRule:e,action:b.parser.tableAction.REDUCE}:!1):!1}}),new j({name:"associativity_resolver",type:i.STATE_SHIFTREDUCE,order:20,resolveFnc:function(a,c,d,e){var f=d.getCurrentSymbol();return f.assoc===b.data.associativity.RIGHT?{action:b.parser.tableAction.SHIFT,itemRule:d}:f.assoc===b.data.associativity.LEFT?{action:b.parser.tableAction.REDUCE,itemRule:e}:!1}})]},a}();b.parser.Parser=function(){var a=function(a){if(this.options=a,b.utils.obj.defineProperty(this,"gotoTable"),b.utils.obj.defineProperty(this,"grammar"),b.utils.obj.defineProperty(this,"actionTable"),b.utils.obj.defineProperty(this,"initialState"),b.utils.obj.defineProperty(this,"stack"),b.utils.obj.defineProperty(this,"currentInput"),!this.gotoTable)throw new Error("Invalid initialization values for a Parser, please provide a GOTO Table");if(!this.actionTable)throw new Error("Invalid initialization values for a Parser, please provide a Action Table");if(!this.grammar)throw new Error("Invalid initialization values for a Parser, please provide a Grammar");if(!this.initialState)throw new Error("Invalid initialization values for a Parser, please provide a Initial State");this.stack=this.stack||[]};return a.prototype.parse=function(a){var c=new b.data.StackItem({state:this.initialState});return this.currentInput=a.getNext(),this.currentInput.ERROR?!1:(this.stack.push(c),this._parse(a))},a.prototype._parse=function(a){for(var c,d,e=this.stack[this.stack.length-1];;){if(d=this.actionTable(e.state.getIdentity(),this.currentInput.terminal),d.action===b.parser.tableAction.ERROR)return!1;if(d.action===b.parser.tableAction.SHIFT)e.symbol=this.currentInput.terminal,e.currentValue=this.currentInput.string,e.stringValue=this.currentInput.string,this.currentInput=a.getNext();else if(d.action===b.parser.tableAction.REDUCE)e=this._reduce(d);else if(d.action===b.parser.tableAction.ACCEPT)return e=this._reduce(d),e.AST.nodes[0];if(c=this.gotoTable[e.state.getIdentity()][e.symbol],!c)return!1;this.stack.push(new b.data.StackItem({state:c})),e=this.stack[this.stack.length-1]}},a.prototype._reduce=function(a){var c,d,e,f={},g=a.rule,h=1===g.tail.length&&g.tail[0].name===b.data.specialSymbol.EMPTY,i=this.stack[this.stack.length-1];return e=h?[]:this.stack.slice(-1*(g.tail.length+1),this.stack.length-1),f.values=b.utils.obj.map(e,function(a){return a.currentValue||a.symbol}),f.rule=g,this.stack=h?this.stack:this.stack.slice(0,-1*g.tail.length),i=this.stack[this.stack.length-1],i.symbol=g.head,i.currentValue=b.utils.obj.isFunction(g.reduceFunc)?g.reduceFunc.call(this,f):i.symbol,d=b.utils.obj.map(e,function(a){return a.AST||a.stringValue}),c=new b.data.ASTNode({nodes:d,rule:g,symbol:g.head,stringValue:i.stringValue,currentValue:i.currentValue}),i.AST=c,i},a}(),b.parser.parserCreator=function(){var a=function(){};return a.create=function(a){a=b.utils.obj.extend({},{automataGenerator:b.parser.AutomataLALR1Generator},a||{});var c=a.grammar,d=new a.automataGenerator({grammar:c}),e=d.generateAutomata({conflictResolvers:b.parser.ConflictResolver.getDefaultResolvers()}),f=d.generateGOTOTable(e),g=d.generateACTIONTable(e,{conflictResolvers:b.parser.ConflictResolver.getDefaultResolvers(),ignoreErrors:!1}),h=new b.lexer.Lexer({grammar:c,stream:a.strInput}),i=new b.parser.Parser({gotoTable:f,grammar:c,actionTable:g,initialState:e.initialStateAccessor()});return{parser:i,lexer:h}},a}()}return b});
//# sourceMappingURL=kappa.min.js.map